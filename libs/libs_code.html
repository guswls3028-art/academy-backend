
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>libs Code Browser</title>
<style>
body {
    background:#0f1115;
    color:#eaeaea;
    font-family:Consolas, monospace;
    padding:24px;
}
h1 { margin-bottom:24px; }
h2 { color:#7dd3fc; font-size:15px; }
pre {
    background:#111418;
    padding:16px;
    border-radius:8px;
    overflow-x:auto;
    font-size:13px;
    line-height:1.5;
}
section { margin-bottom:32px; }
</style>
</head>
<body>
<h1>üì¶ libs</h1>

        <section>
            <h2>observability\__init__.py</h2>
            <pre><code></code></pre>
        </section>
        
        <section>
            <h2>observability\logger.py</h2>
            <pre><code></code></pre>
        </section>
        
        <section>
            <h2>observability\tracing.py</h2>
            <pre><code></code></pre>
        </section>
        
        <section>
            <h2>redis_client\__init__.py</h2>
            <pre><code></code></pre>
        </section>
        
        <section>
            <h2>redis_client\client.py</h2>
            <pre><code>import os
import redis

REDIS_URL = os.getenv(&quot;REDIS_URL&quot;, &quot;redis://localhost:6379/0&quot;)

redis_client = redis.Redis.from_url(
    REDIS_URL,
    decode_responses=True,
)
</code></pre>
        </section>
        
        <section>
            <h2>s3_client\__init__.py</h2>
            <pre><code></code></pre>
        </section>
        
        <section>
            <h2>s3_client\client.py</h2>
            <pre><code># libs/s3_client/client.py

from typing import Tuple
from django.conf import settings
import boto3
from botocore.exceptions import ClientError

# ---------------------------------------------------------------------
# S3 Client (Cloudflare R2)
# ---------------------------------------------------------------------

_s3 = boto3.client(
    &quot;s3&quot;,
    region_name=&quot;auto&quot;,
    endpoint_url=settings.R2_ENDPOINT,
    aws_access_key_id=settings.R2_ACCESS_KEY,
    aws_secret_access_key=settings.R2_SECRET_KEY,
)

# ---------------------------------------------------------------------
# API
# ---------------------------------------------------------------------

def head_object(key: str) -&gt; Tuple[bool, int]:
    &quot;&quot;&quot;
    Check object exists + size (bytes)
    &quot;&quot;&quot;
    try:
        resp = _s3.head_object(
            Bucket=settings.R2_BUCKET,
            Key=key,
        )
        return True, int(resp.get(&quot;ContentLength&quot;) or 0)

    except ClientError as e:
        code = (e.response.get(&quot;Error&quot;) or {}).get(&quot;Code&quot;)
        if code in (&quot;404&quot;, &quot;NoSuchKey&quot;, &quot;NotFound&quot;):
            return False, 0
        raise
</code></pre>
        </section>
        
        <section>
            <h2>s3_client\presign.py</h2>
            <pre><code># libs/s3_client/presign.py

from django.conf import settings
import boto3
from botocore.client import Config

# ---------------------------------------------------------------------
# Constants
# ---------------------------------------------------------------------

PRESIGN_UPLOAD_EXPIRES = 900        # 15 min
PRESIGN_STREAM_EXPIRES = 60 * 60    # 1 hour

# ---------------------------------------------------------------------
# S3 Client (Cloudflare R2)
# ---------------------------------------------------------------------

_s3 = boto3.client(
    &quot;s3&quot;,
    region_name=&quot;auto&quot;,
    endpoint_url=settings.R2_ENDPOINT,
    aws_access_key_id=settings.R2_ACCESS_KEY,
    aws_secret_access_key=settings.R2_SECRET_KEY,
    config=Config(
        signature_version=&quot;s3v4&quot;,
        s3={&quot;addressing_style&quot;: &quot;path&quot;},  # ‚úÖ Î°úÏª¨/Ïö¥ÏòÅ Î™®Îëê ÏïàÏ†ïÏ†Å
    ),
)

# ---------------------------------------------------------------------
# Helpers
# ---------------------------------------------------------------------

def _get_bucket() -&gt; str:
    bucket = getattr(settings, &quot;R2_BUCKET&quot;, None)
    if not bucket:
        raise RuntimeError(&quot;R2_BUCKET is not set in Django settings&quot;)
    return bucket

# ---------------------------------------------------------------------
# Presigned URLs
# ---------------------------------------------------------------------

def create_presigned_put_url(
    key: str,
    expires_in: int = PRESIGN_UPLOAD_EXPIRES,
) -&gt; str:
    &quot;&quot;&quot;
    Generate presigned PUT url (upload)
    &quot;&quot;&quot;
    return _s3.generate_presigned_url(
        ClientMethod=&quot;put_object&quot;,
        Params={
            &quot;Bucket&quot;: _get_bucket(),
            &quot;Key&quot;: key,
        },
        ExpiresIn=expires_in,
    )


def create_presigned_get_url(
    key: str,
    expires_in: int = PRESIGN_STREAM_EXPIRES,
) -&gt; str:
    &quot;&quot;&quot;
    Generate presigned GET url (download / stream)
    &quot;&quot;&quot;
    return _s3.generate_presigned_url(
        ClientMethod=&quot;get_object&quot;,
        Params={
            &quot;Bucket&quot;: _get_bucket(),
            &quot;Key&quot;: key,
        },
        ExpiresIn=expires_in,
    )
</code></pre>
        </section>
        
        <section>
            <h2>tenant_util\__init__.py</h2>
            <pre><code></code></pre>
        </section>
        
        <section>
            <h2>tenant_util\context.py</h2>
            <pre><code></code></pre>
        </section>
        
        <section>
            <h2>tenant_util\validator.py</h2>
            <pre><code></code></pre>
        </section>
        
</body>
</html>
