# 엑셀 파싱 개선 보고서 (한 장)

**일자**: 2026-02-17  
**대상**: `src/application/services/excel_parsing_service.py`

---

## 1. 개요

학원마다 학생 일괄 등록 엑셀 양식이 다르므로, 다양한 헤더·형식을 자동 인식하도록 파싱 로직을 개선했다.

---

## 2. 필수/선택 필드

| 구분 | 필드 | 설명 |
|------|------|------|
| **필수** | 이름 | 학생명 (없으면 건너뜀) |
| **필수** | 학부모 전화 | 010 11자리 (없으면 학생 전화로 대체 시도) |
| 선택 | 학생 전화 | 공란 가능 |
| 선택 | 학교(학년), 성별, 메모 등 | 있으면 매칭 |

---

## 3. 개선 내용

### 3.1 헤더 별칭 확장

- **이름**: 이름, 성명, 학생명, 성함, 학생성명
- **학부모 전화**: 학부모전화번호, 부모핸드폰, 부모 전화, 학부모 전화, 보호자 전화, 휴대폰, 핸드폰, 연락처, 전화번호, 전화, 폰, 폰번호, 부모핸드, 학부모, 보호자
- **학생 전화**: 학생전화번호, 학생핸드폰, 학생 전화, 학생폰, 학생 연락처, 학생핸드, 학생전화
- **성별**: 성별, 남자, 여자, 남성, 여성, 남, 여, 녀
- **학교**: 학교, 학교(학년), 학교명, 출신학교
- **비고/메모**: 메모, 비고, 특이사항, 구분, 체크, 출석, 현장
- **계열**: 계열, 이과, 문과

### 3.2 매칭 방식 개선

- **전각 문자 정규화**: ０１２３ → 0123, 전각 공백 제거
- **부분 매칭**: 별칭 3글자 이상이 헤더에 포함되면 매칭
- **시작 매칭**: 헤더가 짧은 별칭으로 시작하면 매칭 (예: `학부모` → `학부모 전화`)

### 3.3 컬럼 추론 (헤더 미인식 시)

- **전화번호 컬럼**: 010 11자리 패턴이 2행 이상 나오는 컬럼 → 학부모 전화로 추정
- **이름 컬럼**: 2~4글자 한글(+숫자/`*`)이 2행 이상 나오는 컬럼 → 이름으로 추정

### 3.4 강의 제목 추출

- 헤더 행 위 최대 5행에서 4~120자 텍스트를 강의 제목으로 추출
- 결과에 `lecture_title` 포함 (프론트 표시용)

---

## 4. 지원 양식 예시

```
체크 | 이름 | 부모핸드폰 | 학생핸드폰 | 학교(학년) | 31(토) ...
  1  | 강다윤 | 010-2980-0958 | | 숙명여고(０) | 출
  2  | 강예준 | 010-4650-0825 | 010-4972-0829 | 중동고(0) | 출
```

- 학교(학년): `숙명여고(０)`, `휘문중(3)` 등 전각/반각 숫자 모두 인식
- 학생 전화 공란 가능

---

## 5. 배포

- AI 워커 이미지 재빌드 후 배포 시 반영
- `full_redeploy.ps1` 또는 `build_and_push_ecr` → ASG refresh
