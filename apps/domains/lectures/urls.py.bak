from django.urls import path, include
from rest_framework.routers import DefaultRouter

from .views import (
    LectureViewSet,
    SessionViewSet,
    AttendanceViewSet,

    CounselingViewSet,
    QuestionViewSet,
    AnswerViewSet,

    VideoViewSet,
    VideoPermissionViewSet,
    VideoProgressViewSet,

    MaterialCategoryViewSet,
    MaterialViewSet,

    BoardCategoryViewSet,
    BoardPostViewSet,
    BoardReadStatusViewSet,

    DdayViewSet,
)

# ✅ enrollment 도메인에서 import
from apps.domains.enrollment.views import (
    EnrollmentViewSet,
    SessionEnrollmentViewSet,
)

router = DefaultRouter()

# 기본
router.register(r"lectures", LectureViewSet, basename="lectures")
router.register(r"sessions", SessionViewSet, basename="sessions")
router.register(r"enrollments", EnrollmentViewSet, basename="enrollments")
router.register(r"attendances", AttendanceViewSet, basename="attendances")

# 상담
router.register(r"counselings", CounselingViewSet, basename="counselings")

# 질문 / 답변
router.register(r"questions", QuestionViewSet, basename="questions")
router.register(r"answers", AnswerViewSet, basename="answers")

# 영상
router.register(r"videos", VideoViewSet, basename="videos")
router.register(r"video-permissions", VideoPermissionViewSet, basename="video-permissions")
router.register(r"video-progress", VideoProgressViewSet, basename="video-progress")

# 자료실
router.register(r"material-categories", MaterialCategoryViewSet, basename="material-categories")
router.register(r"materials", MaterialViewSet, basename="materials")

# 게시판
router.register(r"board-categories", BoardCategoryViewSet, basename="board-categories")
router.register(r"board-posts", BoardPostViewSet, basename="board-posts")
router.register(r"board-read-status", BoardReadStatusViewSet, basename="board-read-status")

# 디데이
router.register(r"ddays", DdayViewSet, basename="ddays")

# 세션별 수강 등록
router.register(r"session-enrollments", SessionEnrollmentViewSet, basename="session-enrollments")

urlpatterns = [
    path("", include(router.urls)),
]

# -----------------------------
# Nested Video URLs (세션 기준)
# -----------------------------
video_detail = VideoViewSet.as_view({"get": "retrieve"})
video_stats = VideoViewSet.as_view({"get": "stats"})

urlpatterns += [
    path(
        "lectures/<int:lecture_id>/sessions/<int:session_id>/videos/<int:pk>/",
        video_detail,
        name="video-detail-nested",
    ),
    path(
        "lectures/<int:lecture_id>/sessions/<int:session_id>/videos/<int:pk>/stats/",
        video_stats,
        name="video-stats-nested",
    ),
]
