# 배포 — 이렇게 하면 됨

목표: **SSH 접속 잘 되고, 워커 잘 돌아가고, 코드 수정 시 캐시/노캐시 배포 잘 되면 됨.**

---

## 1. SSH 접속

- **API 서버:** EC2 콘솔에서 academy-api 인스턴스 → 연결 → EC2 Instance Connect 또는 Session Manager.
- **워커:** 같은 화면에서 해당 워커 인스턴스 → 연결 → **Session Manager** (Instance Connect 안 되면 이거).

---

## 2. 코드 수정했을 때 배포

**같은 터미널에서 루트 키 설정한 뒤, 아래만 실행.**

**캐시 배포 (보통):**
```powershell
cd C:\academy
.\scripts\full_redeploy.ps1 -GitRepoUrl "https://github.com/guswls3028-art/academy-backend.git" -WorkersViaASG
```

**노캐시 배포 (설정/의존성 바꿨을 때):**
```powershell
.\scripts\full_redeploy.ps1 -GitRepoUrl "https://github.com/guswls3028-art/academy-backend.git" -WorkersViaASG -NoCache
```

끝. 위 둘 중 하나만 돌리면 빌드 → ECR 푸시 → API 배포 → 워커 ASG 새로 고침까지 됨.

---

## 3. 워커가 이상할 때만

풀배포만 했는데 워커가 잘못 뜨면:

```powershell
.\scripts\redeploy_worker_asg.ps1
```
그 다음

```powershell
.\scripts\full_redeploy.ps1 -GitRepoUrl "https://github.com/guswls3028-art/academy-backend.git" -WorkersViaASG -SkipBuild
```

---

**정리:**  
- SSH → Session Manager 쓰면 됨.  
- 배포 → full_redeploy.ps1 하나 (캐시면 그대로, 노캐시면 -NoCache).  
- 워커 이상 시에만 redeploy_worker_asg → full_redeploy -SkipBuild.

다른 문서는 “참고용”이고, **할 때는 이 순서만 보면 됨.**
