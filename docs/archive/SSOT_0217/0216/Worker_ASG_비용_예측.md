# Worker ASG 비용 예측 (동영상 3~4 TB/월 가정)

**전제**: ASG Target Tracking, Min=0, **Max=20**, 동영상 워커 t4g.medium + 100GB EBS.  
**가정**: 한 달 동영상 업로드(처리) 총량 **3~4 TB**.

**트래픽 구조**: 학생은 영상을 **R2 + Cloudflare(클플) CDN**으로 시청만 함. 본 문서는 워커(트랜스코딩)·업로드/처리 구간과 **R2 저장 비용**을 포함하며, 시청 트래픽은 R2+클플 구조 특성상 아래와 같이 반영함.

---

## 0. 트래픽·비용 전략 (역할별)

| 역할 | 동작 | 비용 영향 |
|------|------|-----------|
| **학생** | **시청만** (스트리밍), **다운로드(파일 저장) 기능 미제공** | R2+Cloudflare CDN: **인터넷 egress GB 기반 과금 없음**. 비용은 R2 저장 용량·요청 수 위주. |
| **강사** | **업로드 + 삭제** 위주, **다운로드 거의 없음** | R2 업로드·정책으로 전송비 최소화. |

**R2 + Cloudflare CDN 정리**  
- R2 → Cloudflare 전송 **무료**, Cloudflare → 사용자 전송 **무료**(일반 CDN 플랜 기준 GB egress 별도 과금 없음).  
- 시청량 증가 시 비용 증가는 주로 **R2 Class B 요청(Chunk GET)** 증가에 의존하며, **GB 기반 egress 폭증 리스크는 없음**.

**이 전략 적용 시 예상 (3~4 TB/월)**  
- **워커·인프라**: 아래 §1~2.  
- **R2 저장**: §3. 저장 4TB 기준 약 **$60/월** 수준.  
- **합계**: 워커 $15~35 + R2 저장 ~$60 → **월 약 $75~95** (약 10만~13만 원) 수준 참고.

---

## 1. 유지비 (고정/관리 비용)

| 항목 | 내용 | 월 비용 |
|------|------|--------|
| **평시 워커** | Min=0 → 0대 상시 | **$0** |
| **CloudWatch 메트릭** | PutMetricData 소량 (ASG 메트릭 등) | **~$0.5** |
| **SQS** | 요청/메시지 수 (3~4TB 구간 추정) | **~$1~3** |
| **운영 개입** | ASG 자동화로 수동 기동/모니터링 최소 | 인건비 외 |

→ **유지비: 월 약 $0~5**. 기본 구성은 **ASG Target Tracking만** 사용하므로 큐 깊이 Lambda는 불필요. (옵션 Step Scaling·커스텀 지표 시 Lambda 소액 가능.)

---

## 2. 워커 비용 (EC2 + EBS, 3~4 TB/월 처리)

### 2.1 가정

- **처리량**: 3~4 TB/월.
- **워커**: t4g.medium (서울) ≈ **$0.0336/시간**, 100GB gp3.
- **처리 효율**: 1TB당 **50~150** worker-hour 가정 (보수적 100시간/TB).

### 2.2 EC2 (Video 워커)

| 시나리오 | TB/월 | worker-hour/TB | 총 worker-hour/월 | EC2 비용 (t4g.medium) |
|----------|-------|----------------|--------------------|-------------------------|
| 가벼움 | 3 TB | 50 | 150 | **약 $5** |
| 보통 | 3.5 TB | 100 | 350 | **약 $12** |
| 부하 큼 | 4 TB | 150 | 600 | **약 $20** |

→ **EC2: 월 약 $5~20**.

### 2.3 EBS (100GB)

- **EBS는 인스턴스에 볼륨이 붙어 존재하는 시간(=런타임)에 비례** 과금. terminate 시 **Delete on termination** 설정 전제(볼륨 삭제 시 과금 종료).
- 350 worker-hour/월 기준 대략 **월 $3~8** 구간.

### 2.4 워커 구간 요약

| 구분 | 낮은 쪽 | 높은 쪽 |
|------|---------|---------|
| 유지비 | $0 | ~$5 |
| EC2 | $5 | $20 |
| EBS | $3 | $8 |
| **워커 합계 (월)** | **약 $8** | **약 $33** |

**현실적 중간값: 월 약 $15~35** (약 2만~5만 원). Max=20은 상한만 올린 것이라 평시 Min=0이면 고정 비용 증가 없음.

---

## 3. R2 저장 비용 (참고)

- **R2**: 저장 **$0.015/GB/월**, Class A/B 요청 소액. **egress 무료**.
- **3~4 TB 저장** 가정: 4,000GB × $0.015 ≈ **$60/월**. Class B 요청은 수 달러 수준.
- 시청량이 늘어나도 **GB 기반 egress 과금은 없음**. 비용은 저장 용량·요청 수 위주.

---

## 4. 월 비용 요약 (워커 + R2)

| 구분 | 낮은 쪽 | 높은 쪽 |
|------|---------|---------|
| 워커 (유지+EC2+EBS) | **약 $8** | **약 $33** |
| R2 저장 (4TB 가정) | **약 $55** | **약 $65** |
| **합계 (월)** | **약 $63** | **약 $98** |

- **현실적 중간값**: **월 약 $75~95** (약 10만~13만 원). 워커만 보면 $15~35, R2 포함 시 위 구간.

---

## 5. 비용 절감 팁

- **트래픽 전략**: 다운로드(파일 저장) 미제공, 시청만 → R2 egress 무료 구조 유지.
- **Spot** 혼합 시 EC2 단가 50~70% 절감 가능.
- **CloudWatch 로그** 보관 7~14일로 제한.
- R2 오래된 영상 삭제·보관 정책으로 저장 비용 조절.

---

**문서 위치**: `docs/0216/Worker_ASG_비용_예측.md`. ASG 설계는 [ASG_설계_확정.md](ASG_설계_확정.md) 참고.
