# 30K 기준 (목표·설계)

**목표**: 3만 명 규모까지 확장 시 준수할 설계·워커·비용 기준.

---

## 1. 전제

- **10K 기준**: [10K_기준.md](10K_기준.md) 달성 후 30K 단계 진행.
- **워커**: 500·10K에서 ASG Target Tracking(Min=0) 사용. 30K에서도 ASG 기반, 정책만 강화.

---

## 2. 30K 단계 핵심

| 항목 | 내용 |
|------|------|
| **워커 스케일** | ASG 전환 유지. Video·AI 워커 Min=0, Max 확대(예: 20→필요 시 상향). CPU·Heartbeat 기반 정책 검토. |
| **비용 하드캡** | AWS Budgets·알람. 워커·R2·RDS 상한선 설정. |
| **Premium·Batch·High-priority** | Lite/Basic 외 **Premium 사용·Batch·High-priority** 큐 분리 검토. 상용 SaaS·AI 워커 1종 이상 분리. |
| **Self-stop** | 10K 이전 Stage에서는 워커 빈 폴 → EC2 Stop 유지 가능. **30K(ASG 전환 시)**: Self-stop 제거, scale-in은 ASG 정책만 수행. |

---

## 3. 워커·오토스케일

- **Scale-out**: SQS 깊이(또는 CloudWatch 메트릭) → ASG Target Tracking. 0→N 부팅 지연 감수.
- **Scale-in**: ASG가 terminate. 처리 중인 SQS 메시지는 **완료 후** 종료되도록 Lifecycle Hook 또는 워커 SIGTERM 처리 권장.
- **Lambda 제거**: 수동 Lambda Start/Stop 제거. ASG 단일 제어.

---

## 4. SLO·비용

- 10K SLO 유지. API P95·AI Job 완료 시간·DLQ 비율·DB 커넥션·Video 디스크 등 동일 원칙.
- 비용: R2 저장·EC2 워커·EBS·RDS 확장에 따른 상한선·알람 설정.

---

## 5. 실행 순서

1. 10K 기준 문서 점검·달성 확인  
2. ASG Max·Target 값 조정(트래픽 시뮬레이션 또는 단계적 상향)  
3. 비용 하드캡·Budget 알람 설정  
4. Premium/Batch 큐·워커 분리(필요 시)  
5. Self-stop 제거·ASG scale-in만 사용

이 문서는 30K 목표 시 **기준점**으로 사용. 상세 Stage·시뮬레이션은 필요 시 별도 설계 문서에서 확장.
