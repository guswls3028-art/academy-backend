# ==============================================================================
# academy-api reverse proxy (B1: X-Internal-Key 전달)
# ==============================================================================
# EC2 호스트 nginx에 복사: /etc/nginx/conf.d/academy-api.conf
# 또는 sites-available → sites-enabled
# ==============================================================================
# B1 backlog-count API: Lambda가 X-Internal-Key로 인증. Cloudflare/nginx가
# 기본적으로 custom header를 upstream으로 전달하지 않으므로 명시적으로 추가.
# ==============================================================================

server {
    listen 80;
    server_name api.hakwonplus.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        # B1: Lambda internal API 인증용
        proxy_set_header X-Internal-Key $http_x_internal_key;
        proxy_connect_timeout 60s;
        proxy_send_timeout 120s;
        proxy_read_timeout 120s;
    }
}
